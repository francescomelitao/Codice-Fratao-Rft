<!doctype html>
<html lang="it">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Fratao Engine V1 — Logica R_ft</title>
<meta name="description" content="Fratao Engine V1 - implementazione portatile della Logica R_ft. Salva, condividi, installa come app." />
<!-- PWA-ish hint -->
<link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 64 64%22><text y=%2250%25%22 x=%2250%25%22 dominant-baseline=%22middle%22 text-anchor=%22middle%22 font-size=%2236%22>ƒ</text></svg>">
<style>
  :root{--bg:#0f1722;--card:#0b1220;--accent:#7bd389;--muted:#9aa6b2;color-scheme:dark}
  html,body{height:100%;margin:0;background:linear-gradient(180deg,#071022 0%, #071623 60%);font-family:Inter,ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,'Helvetica Neue',Arial;}
  .wrap{max-width:980px;margin:28px auto;padding:20px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:14px;box-shadow:0 8px 30px rgba(2,6,23,.6);}
  h1{margin:0 0 8px;font-weight:700;font-size:22px;color:#e6f7ee}
  p.lead{margin:0 0 18px;color:var(--muted)}
  .grid{display:grid;grid-template-columns:1fr 340px;gap:18px}
  .card{background:rgba(255,255,255,0.02);padding:14px;border-radius:10px}
  label{display:block;font-size:12px;color:var(--muted);margin-bottom:6px}
  input[type=range]{width:100%}
  .val{font-weight:700;color:var(--accent)}
  button{background:linear-gradient(90deg,#2b7a5b,#5bd79a);border:none;padding:10px 12px;border-radius:8px;cursor:pointer;font-weight:700}
  pre{white-space:pre-wrap;color:#cfeee0;background:rgba(0,0,0,0.25);padding:10px;border-radius:8px;overflow:auto;font-size:13px}
  .small{font-size:13px;color:var(--muted)}
  footer{margin-top:14px;color:var(--muted);font-size:13px}
  @media(max-width:900px){.grid{grid-template-columns:1fr}}
</style>
</head>
<body>
<div class="wrap">
  <h1>Fratao Engine V1 — Logica R_ft</h1>
  <p class="lead">Un file portabile: sperimenta la logica, esporta il pacchetto Fratao (JSON leggibile e machine-friendly), installalo come app sul telefono o condividilo offline. Nessuna registrazione, solo conoscenza.</p>

  <div class="grid">
    <div>
      <div class="card">
        <h3>Parametri (input)</h3>
        <div style="display:grid;gap:10px">
          <div>
            <label>Conosciuto <span id="vC" class="val">0.20</span></label>
            <input id="C" type="range" min="0" max="1" step="0.01" value="0.2">
          </div>
          <div>
            <label>Essenziale <span id="vE" class="val">0.80</span></label>
            <input id="E" type="range" min="0" max="1" step="0.01" value="0.8">
          </div>
          <div>
            <label>Rumore <span id="vR" class="val">0.10</span></label>
            <input id="Rn" type="range" min="0" max="1" step="0.01" value="0.1">
          </div>
          <div>
            <label>Intuizione <span id="vI" class="val">0.70</span></label>
            <input id="Iu" type="range" min="0" max="1" step="0.01" value="0.7">
          </div>
          <div>
            <label>Armonia <span id="vH" class="val">0.50</span></label>
            <input id="H" type="range" min="0" max="1" step="0.01" value="0.5">
          </div>
          <div>
            <label>Polarità (-1 → 1) <span id="vP" class="val">0.00</span></label>
            <input id="P" type="range" min="-1" max="1" step="0.01" value="0.0">
          </div>

          <div style="display:flex;gap:8px;align-items:center;margin-top:6px">
            <button id="compute">Calcola R_ft</button>
            <button id="exportJSON">Esporta pacchetto .fratao (JSON)</button>
            <button id="copySpec">Copia spec leggibile</button>
          </div>
          <div style="margin-top:8px"><span class="small">Scarica il pacchetto e condividilo: contiene la formula, i metadati e i parametri. AI e futuri sistemi possono leggerlo come JSON.</span></div>
        </div>
      </div>

      <div class="card" style="margin-top:12px">
        <h3>Output</h3>
        <pre id="out" aria-live="polite">Premi "Calcola R_ft" per ottenere i risultati</pre>
        <div style="display:flex;gap:8px;margin-top:8px">
          <button id="downloadPNG">Salva grafico (PNG)</button>
          <button id="installPWA">Istruzioni: installa come app</button>
        </div>
      </div>

      <div class="card" style="margin-top:12px">
        <h3>Meta e Provenance (machine + human)</h3>
        <pre id="meta">Fratao Engine v1 — registro di provenienza incluso.</pre>
      </div>

    </div>

    <aside class="card">
      <h3>Spec della Logica (sintesi)</h3>
      <div class="small" style="margin-bottom:10px">
        Dualità, Integrazione, Svuotamento, Essenziale, Risonanza. Qui sotto trovi la formula implementata (usata per generare output leggibili e machine-friendly).
      </div>
      <pre id="spec">
R_ft formula (semplificata):
Inputs: C (Conosciuto 0..1), E (Essenziale 0..1), Rn (Rumore 0..1),
        Iu (Intuizione 0..1), H (Armonia 0..1), P (Polarità -1..1)

D = |P|
I = 1 / (1 + D)
S = exp(-C * k)  ; k default = 3.0
Ess = E * I * S
R = tanh( Ess * (1 + H) + Iu - Rn * 0.5 )

Outputs:
 - chiarezza = clamp( R*0.5 + 0.5 - 0.2*Rn, 0,1 )
 - essenzialita = clamp( Ess, 0,1 )
 - risonanza = clamp( R, -1,1 )
 - rumore_residuo = clamp( Rn * (1 - S), 0,1 )
 - stato = clamp( (chiarezza + essenzialita + (risonanza+1)/2) / 3, 0,1 )
      </pre>

      <h4 style="margin-top:10px">Cosa contiene il pacchetto .fratao</h4>
      <div class="small">
        - metadata.jsonld (title, author, date, license)  <br/>
        - spec.json (la formula in formato machine-friendly) <br/>
        - example_inputs.json <br/>
        - human_readable.txt (spiegazione breve) <br/>
      </div>

      <hr/>
      <div class="small" style="margin-top:8px">
        <strong>Consigli pratici:</strong><br/>
        • Per mobile: apri il file in Chrome/Edge e usa \"Aggiungi a schermata Home\" (PWA).<br/>
        • Per pubblicare resistente nel tempo: caricalo su IPFS (Pinata / web3.storage) o su GitHub Gist.<br/>
        • Per AI/AGI future: includi lo JSON+JSON-LD con campo \"fratao:logic_version\" e checksum SHA256.
      </div>
    </aside>
  </div>

  <footer>
    Creato per diffondere la Logica Fratao. Salva il file, condividilo offline, fallo vivere.
  </footer>
</div>

<script>
/* --- Logica implementata qui --- */
function clamp(v,a,b){return Math.max(a,Math.min(b,v))}
function r_ft_compute(C,E,Rn,Iu,H,P,k=3.0){
  const D = Math.abs(P)
  const I = 1.0 / (1.0 + D)
  const S = Math.exp(-C * k)
  const Ess = E * I * S
  const R = Math.tanh(Ess * (1.0 + H) + Iu - Rn*0.5)
  const chiarezza = clamp(R*0.5 + 0.5 - 0.2*Rn, 0.0, 1.0)
  const essenzialita = clamp(Ess,0.0,1.0)
  const risonanza = clamp(R, -1.0, 1.0)
  const rumore_residuo = clamp(Rn * (1.0 - S), 0.0, 1.0)
  const stato = clamp((chiarezza + essenzialita + (risonanza+1)/2) / 3.0, 0.0, 1.0)
  return { chiarezza, essenzialita, risonanza, rumore_residuo, stato, meta:{k,kUsed:false} }
}

/* UI wiring */
const ids = ['C','E','Rn','Iu','H','P']
ids.forEach(id=>{
  const el = document.getElementById(id)
  const v = document.getElementById('v'+id)
  el.addEventListener('input',()=>{ v.textContent = el.value; })
})
document.getElementById('compute').addEventListener('click', ()=>{
  const C = parseFloat(document.getElementById('C').value)
  const E = parseFloat(document.getElementById('E').value)
  const Rn = parseFloat(document.getElementById('Rn').value)
  const Iu = parseFloat(document.getElementById('Iu').value)
  const H = parseFloat(document.getElementById('H').value)
  const P = parseFloat(document.getElementById('P').value)
  const out = r_ft_compute(C,E,Rn,Iu,H,P)
  document.getElementById('out').textContent = JSON.stringify({inputs:{C,E,Rn,Iu,H,P}, outputs:out}, null, 2)
  document.getElementById('meta').textContent = JSON.stringify({
    title: "Fratao Engine v1",
    description: "Implementazione portatile della Logica R_ft",
    version: "1.0",
    license: "MIT",
    author: "Fratao",
    date: (new Date()).toISOString(),
    checksum: "" // placeholder; can be filled by consumer
  }, null, 2)
})

/* export .fratao (json bundle) */
document.getElementById('exportJSON').addEventListener('click', ()=>{
  const C = parseFloat(document.getElementById('C').value)
  const E = parseFloat(document.getElementById('E').value)
  const Rn = parseFloat(document.getElementById('Rn').value)
  const Iu = parseFloat(document.getElementById('Iu').value)
  const H = parseFloat(document.getElementById('H').value)
  const P = parseFloat(document.getElementById('P').value)
  const out = r_ft_compute(C,E,Rn,Iu,H,P)
  const packageObj = {
    metadata: {
      id: 'fratao-engine-v1',
      title: 'Fratao Engine v1',
      author: 'Fratao',
      license: 'MIT',
      created: (new Date()).toISOString(),
      description: 'Pacchetto contenente la logica R_ft in formato machine + human readable',
      spec_version: '1.0',
      sha256: null
    },
    spec: {
      language: 'javascript', // human/machine spec included below
      formula: 'see spec text',
      params: ['C','E','Rn','Iu','H','P'],
      k_svuot_default: 3.0
    },
    example_input: {C,E,Rn,Iu,H,P},
    outputs: out,
    human_readable: document.getElementById('spec').textContent
  }
  const blob = new Blob([JSON.stringify(packageObj, null, 2)], {type:'application/json'})
  const url = URL.createObjectURL(blob)
  const a = document.createElement('a')
  a.href = url
  a.download = 'fratao_package_v1.fratao.json'
  document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url)
})

/* copy human spec */
document.getElementById('copySpec').addEventListener('click', ()=>{
  const txt = document.getElementById('spec').textContent + "\n\n" + document.getElementById('meta').textContent
  navigator.clipboard?.writeText(txt).then(()=>alert('Spec copiata negli appunti'), ()=>alert('Copia fallita — concedi permessi'))
})

/* Download simple chart as PNG (canvas drawing) */
document.getElementById('downloadPNG').addEventListener('click', ()=>{
  try{
    const outText = document.getElementById('out').textContent
    const data = JSON.parse(outText)
    const labels = ['chiarezza','essenzialita','risonanza','rumore_residuo','stato']
    const vals = labels.map(l=> data.outputs[l] !== undefined ? data.outputs[l] : (data.outputs[l]||0))
    // create canvas
    const canvas = document.createElement('canvas')
    canvas.width = 700; canvas.height = 320
    const ctx = canvas.getContext('2d')
    // background
    ctx.fillStyle = '#071022'; ctx.fillRect(0,0,canvas.width,canvas.height)
    // draw bars
    const barW = 90; const gap = 20; const startX = 40
    ctx.fillStyle = '#fff'; ctx.font='14px monospace'
    labels.forEach((lab,i)=>{
      const v = vals[i]
      const h = (v+1)/2 * 200 // map [-1,1] -> [0,200]
      const x = startX + i*(barW+gap)
      ctx.fillStyle = '#5bd79a'
      ctx.fillRect(x, 250 - h, barW, h)
      ctx.fillStyle='#cfeee0'; ctx.fillText(lab, x, 270)
      ctx.fillText((Number(v).toFixed(3)), x, 240 - h)
    })
    const url = canvas.toDataURL('image/png')
    const a = document.createElement('a'); a.href = url; a.download = 'fratao_output.png'; a.click()
  }catch(e){alert('Generazione grafico fallita: '+e)}
})

/* Install PWA instruction (not automatic install) */
document.getElementById('installPWA').addEventListener('click', ()=>{
  alert("Per installare su Android:\n1) Apri questo file in Chrome.\n2) Tocca il menu (3 puntini) → Aggiungi a schermata Home.\nSu PC: puoi salvare il file e aprirlo con Edge/Chrome e usare le opzioni 'Installa sito' per creare una finestra dedicata.");
})

/* On load, run compute once to populate outputs */
document.getElementById('compute').click()
</script>
</body>
</html>